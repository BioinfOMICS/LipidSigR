---
title: "Enrichcment"
output: rmarkdown::html_vignette
bibliography: ref.bib 
description: >
  "Enrichment" 
    provides two main approaches: 'Over Representation Analysis (ORA)' and 'Lipid Set 
    Enrichment Analysis (LSEA)' to illustrates significant lipid species enriched in 
    the categories of lipid class and determine whether an a priori-defined set of 
    lipids shows statistically significant, concordant differences between two 
    biological states (e.g., phenotypes).
vignette: >
  %\VignetteIndexEntry{Enrichcment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r load_package, message = FALSE, echo=FALSE}
library(dplyr)
library(utils)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(fig.width = 6)
```

Enrichment analysis provides two main approaches: 'Over Representation Analysis (ORA)' 
and 'Lipid Set Enrichment Analysis (LSEA)'. ORA analysis illustrates significant 
lipid species enriched in the categories of lipid class. LSEA analysis is a 
computational method determining whether an a priori-defined set of lipids 
shows statistically significant, concordant differences between two biological 
states (e.g., phenotypes).

The input data must be a SummarizedExperiment object `deSp_se` generated by 
`LipidSigR::deSp_twoGroup` or `LipidSigR::deSp_multiGroup`. 
Please read `lipid species differential expression analysis` section in `vignette("3_de")`.

To use our data as an example, follow the steps below.
```{r load LipidSigR, message=FALSE}
# load package
library(LipidSigR)

# load the example SummarizedExperiment
data("de_data_twoGroup")

# data processing
processed_se <- data_process(
    de_data_twoGroup, exclude_missing=TRUE, exclude_missing_pct=70, 
    replace_na_method='min', replace_na_method_ref=0.5, 
    normalization='Percentage')

# conduct differential expression analysis of lipid species
deSp_se <- deSp_twoGroup(
    processed_se, ref_group='ctrl', test='t-test',
    significant='pval', p_cutoff=0.05, FC_cutoff=1, transform='log10')
```

# Over Representation Analysis (ORA)
The Over-Representation analysis provides whether significant lipid species are 
enriched in the categories of lipid class. Results are presented in tables and bar plots 
categorizing lipid species into 'up-regulated' or 'down-regulated' groups 
based on log2 fold change.

Here, we use two-group data as an example.
```{r Enrichment: ora all, fig.width=12}
# conduct ORA 
ora_all <- enrichment_ora(
    deSp_se, char=NULL, significant='pval', p_cutoff=0.05)

# result summary 
summary(ora_all)

# view result: ORA bar plot
ora_all$static_barPlot 
```

**ORA bar plot of all characteristics**
The bar plot shows the top 10 significant up-regulated and down-regulated terms.


* You can obtain the selectable lipid characteristics for the `char` input 
using `LipidSigR::list_lipid_char`. Please read `vignette("1_tool_function")`.

Here, we use `class` as the `char` input for an example.
```{r Enrichment: ora one}
# conduct ORA of a specific `char`
ora_one <- enrichment_ora(
    deSp_se, char='class', significant='pval', p_cutoff=0.05)

# result summary 
summary(ora_one)

# view result: ORA bar plot
ora_one$static_barPlot 
```

**ORA bar plot of specific characteristics**
The bar plot classifies significant lipid species into 'up-regulated' or 'down-regulated' categories based on their log2 fold change, according to a selected characteristic. Red bars indicate up-regulated, blue bars represent down-regulated, and grey bars signify non-significant.


## Lipid Set Enrichment Analysis (LSEA)
Lipid Set Enrichment Analysis (LSEA) is a computational method determining 
whether an a priori-defined set of lipids shows statistically significant, 
concordant differences between two biological states (e.g., phenotypes). 
Results are presented in tables and bar plots categorizing 
lipid species into 'up-regulated' or 'down-regulated' groups based on NES 
(Normalized Enrichment Score), and a table.

```{r Enrichment: LSEA all, fig.width=12}
# conduct LSEA
lsea_all <- enrichment_lsea(
    deSp_se, char=NULL, rank_by='statistic', significant='pval', 
    p_cutoff=0.05)

# result summary 
summary(lsea_all)

# view result: LSEA bar plot
lsea_all$static_barPlot
```

**LSEA bar plot of all characteristics**
The bar plot shows the top 10 significant up-regulated and down-regulated terms.


* You can obtain the selectable lipid characteristics for the `char` input 
using `LipidSigR::list_lipid_char`. Please read `vignette("1_tool_function")`.

Here, we use `class` as the `char` input for an example.
```{r Enrichment: LSEA one}
# conduct LSEA of a specific `char`
lsea_one <- enrichment_lsea(
    deSp_se, char='class', rank_by='statistic', 
    significant='pval', p_cutoff=0.05)

# result summary 
summary(lsea_one)

# view result: LSEA bar plot
lsea_one$static_barPlot
```

**LSEA bar plot of a specific `char`**
The bar plot classifies significant lipid species into 'up-regulated' or 'down-regulated' categories based on their log2 fold change, according to a selected characteristic. Red bars indicate up-regulated, blue bars represent down-regulated, and grey bars signify non-significant.


After running `enrichment_lsea`, you can continue executing `plot_enrichment_lsea` to plot the enrichment plot further.
Please use the whole output of `enrichment_lsea` as the input for plotting.
```{r Enrichment: LSEA one plotting, fig.width=7.8, fig.height=4}
# plot LSEA results
lsea_plot <- plot_enrichment_lsea(
    lsea_res=lsea_one, char='class', char_feature='TG')

# view result: enrichment plot
lsea_plot
```
