---
title: "Network"
output: rmarkdown::html_vignette
bibliography: ref.bib 
description: >
  "Network" provides functions for generates input table for constructing pathway 
  activity network, lipid reaction network and GATOM network.
vignette: >
  %\VignetteIndexEntry{Network}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r load_package, message = FALSE, echo=FALSE}
library(dplyr)
library(utils)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(fig.width = 6, fig.height = 5)
```

`LipidSigR` provides three network functions to quickly generate input data for constructing networks.
After running the corresponding function, you will
obtain the input data for a specific network. The available networks include the 
Pathway Activity Network, Lipid Reaction Network, and GATOM Network. 
Detailed instructions for each are described in the following sections.

* NOTE: These functions only allow for two-group data.

The input data must be a SummarizedExperiment object `deSp_se` generated by `LipidSigR::deSp_twoGroup`. 
Please read `lipid species differential expression analysis` section in `vignette("3_de")`.

To use our data as an example, follow the steps below.
```{r load LipidSigR, message=FALSE}
# load package
library(LipidSigR)

# load the example SummarizedExperiment
data("de_data_twoGroup")

# data processing
processed_se <- data_process(
    de_data_twoGroup, exclude_missing=TRUE, exclude_missing_pct=70, 
    replace_na_method='min', replace_na_method_ref=0.5, 
    normalization='Percentage')

# conduct differential expression analysis of lipid species
deSp_se <- deSp_twoGroup(
    processed_se, ref_group='ctrl', test='t-test',
    significant='pval', p_cutoff=0.05, FC_cutoff=1, transform='log10')
```


# Pathway activity network
The network provides activity pathways among lipid classes.

Follow the instructions below to get the input data for constructing the network.
```{r Network: Pathway activity network}
# generate table for constructing Pathway activity network
network_table <- nw_pathway_activity(deSp_se, organism='mouse')

# result summary
summary(network_table)
```

After obtaining all the returned tables, you can use them to construct a 
network. Here, we use the `visNetwork` package to display an example.
```{r }
# network visualization
library(visNetwork)
network <- visNetwork(
    nodes=network_table$table_node, edges=network_table$table_edge) %>%
    visLayout(randomSeed=500) %>%
    visPhysics(
        solver='barnesHut', stabilization=TRUE, 
        barnesHut=list(gravitationalConstant=-3000)) %>%
    visInteraction(navigationButtons=TRUE) %>%
    visEvents(
        dragEnd="function () {this.setOptions( { physics: false } );}") %>%
    visEdges(color=list(color="#DDDDDD",highlight="#C62F4B")) %>%
    visOptions(
        highlightNearest=list(enabled=TRUE, degree=1, hover=FALSE),
        selectedBy="group", nodesIdSelection=TRUE)

# view network
network
```


# Lipid reaction network
This network illustrates the important reactions of differentially expressed lipid classes and species.

Follow the instructions below to get the input data for constructing the network.
```{r Network: Lipid reaction network}
# generate table for constructing Lipid reaction network
network_table <- nw_lipid_reaction(
    deSp_se, organism='mouse', show_sp='sigClass', show_all_reactions=FALSE,
    sp_significant='pval', sp_p_cutoff=0.05, sp_FC_cutoff=1,
    class_significant='pval', class_p_cutoff=0.05, class_FC_cutoff=1)

# result summary
summary(network_table)
```

After obtaining all the returned tables, you can use them to construct a 
network. Here, we use the `visNetwork` package to display an example.
```{r}
library(visNetwork)
# network visualization
network <- visNetwork(
    nodes=network_table$table_node, edges=network_table$table_edge) %>%
    visLayout(randomSeed=500) %>%
    visPhysics(
        solver='barnesHut', stabilization=TRUE, 
        barnesHut=list(gravitationalConstant=-2500)) %>%
    visInteraction(navigationButtons=TRUE) %>%
    visEvents(
        dragEnd="function () {this.setOptions( { physics: false } );}") %>%
    visOptions(
        highlightNearest=list(enabled=TRUE, degree=1, hover=FALSE),
        selectedBy="group", nodesIdSelection=TRUE)

# view network
network
```


# GATOM network
The network shows the important reactions of differentially expressed lipid species.

Follow the instructions below to get the input data for constructing the network.
```{r Network: GATOM network}
# generate table for constructing GATOM network
network_table <- nw_gatom(
    deSp_se, organism='mouse', n_lipid=50, sp_significant='pval',
    sp_p_cutoff=0.05, sp_FC_cutoff=1)

# result summary
summary(network_table)
```

After obtaining all the returned tables, you can use them to construct a 
network. Here, we use the `visNetwork` package to display an example.
```{r}
library(visNetwork)
# network visualization
network <- visNetwork(
    nodes=network_table$table_node, edges=network_table$table_edge) %>%
    visLayout(randomSeed=500) %>%
    visPhysics(
        solver='barnesHut', stabilization=TRUE, 
        barnesHut=list(gravitationalConstant=-3000)) %>%
    visInteraction(navigationButtons=TRUE) %>%
    visEvents(
        dragEnd="function () {this.setOptions( { physics: false } );}") %>%
    visEdges(color=list(color="#DDDDDD",highlight="#C62F4B")) %>%
    visOptions(
        highlightNearest=list(enabled=TRUE, degree=1, hover=FALSE),
        selectedBy="group", nodesIdSelection=TRUE)

# view network
network
```
